package net.ccbluex.liquidbounce.features.module.modules.exploit

import net.ccbluex.liquidbounce.event.EventTarget
import net.ccbluex.liquidbounce.event.PacketEvent
import net.ccbluex.liquidbounce.event.UpdateEvent
import net.ccbluex.liquidbounce.features.module.Module
import net.ccbluex.liquidbounce.features.module.ModuleCategory
import net.ccbluex.liquidbounce.features.module.ModuleInfo
import net.ccbluex.liquidbounce.utils.ChatUtil
import net.minecraft.network.handshake.client.C00Handshake
import net.minecraft.network.play.client.C00PacketKeepAlive
import net.minecraft.network.play.client.C03PacketPlayer
import net.minecraft.network.play.client.C0FPacketConfirmTransaction
import net.minecraft.network.play.server.S00PacketKeepAlive
import net.minecraft.network.play.server.S08PacketPlayerPosLook
import org.lwjgl.input.Keyboard

@ModuleInfo(
    name = "AntiDesync",
    description = "Allows you to fly in survival mode.",
    category = ModuleCategory.EXPLOIT,
    keyBind = Keyboard.KEY_NONE
)
class AntiDesync : Module() {

    @EventTarget
    fun onPacket(event: PacketEvent){
        if (event.packet is S00PacketKeepAlive){
            var packet = event.packet
          //  event.cancelEvent()
            mc.thePlayer.sendQueue.addToSendQueue(C03PacketPlayer.C04PacketPlayerPosition(mc.thePlayer.posX,mc.thePlayer.posY / 1 - 1,mc.thePlayer.posZ,true))
            mc.thePlayer.sendQueue.addToSendQueue(C0FPacketConfirmTransaction((11192 / 1.0E-5).toInt(),
                (1).toShort(),true))

        }
        if (event!!.packet is S08PacketPlayerPosLook){
            event.cancelEvent()
           // mc.thePlayer.sendQueue.addToSendQueue(C03PacketPlayer.C04PacketPlayerPosition(mc.thePlayer.motionX,mc.thePlayer.posY,mc.thePlayer.motionZ,false))
        }
    }

    @EventTarget
    fun onDamage(event: UpdateEvent){
        if (mc.thePlayer.health < 20){
            mc.thePlayer.sendQueue.addToSendQueue(C03PacketPlayer())
        }
    }

    override fun onEnable() {
        mc.thePlayer.sendQueue.addToSendQueue(C0FPacketConfirmTransaction((11192 / 1.0E-5).toInt(),
            (1).toShort(),true))
        ChatUtil.printChat("Desynced verus")
    }

}